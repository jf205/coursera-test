
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CodeQL library for Java &#8212; Learn CodeQL</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.25',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Analyzing data flow in Java" href="dataflow.html" />
    <link rel="prev" title="Basic query for Java code" href="basic-query-java.html" />
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i) {w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var  f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);}) (window,document,'script','dataLayer','GTM-5Q9DBRM');</script>
  <!-- End Google Tag Manager -->
  
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  </head>
  <body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q9DBRM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="siteBanner">
    <div class="logocontainer">
        <a href="https://securitylab.github.com" id="Header-logo" class="">
                <svg width="100%" height="100%" viewBox="0 0 696 160" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="696" height="160" fill="white"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M80.0397 32.8C53.4747 32.8 32 54.4342 32 81.1965C32 102.59 45.7597 120.699 64.8483 127.109C67.2344 127.59 68.1093 126.067 68.1093 124.785C68.1093 123.664 68.0297 119.818 68.0297 115.811C54.6677 118.696 51.884 110.042 51.884 110.042C49.7365 104.433 46.5551 102.991 46.5551 102.991C42.1806 100.026 46.8732 100.026 46.8732 100.026C51.7249 100.347 54.27 104.994 54.27 104.994C58.565 112.366 65.4846 110.283 68.2684 109C68.666 105.876 69.9386 103.712 71.2907 102.51C60.6329 101.388 49.4184 97.2219 49.4184 78.6325C49.4184 73.3441 51.3272 69.0173 54.3496 65.6519C53.8724 64.45 52.2021 59.4822 54.8268 52.8317C54.8268 52.8317 58.8831 51.5496 68.0297 57.7995C71.8475 56.7579 75.9833 56.197 80.0397 56.197C84.096 56.197 88.2319 56.7579 92.0496 57.7995C101.196 51.5496 105.253 52.8317 105.253 52.8317C107.877 59.4822 106.207 64.45 105.73 65.6519C108.832 69.0173 110.661 73.3441 110.661 78.6325C110.661 97.2219 99.4464 101.308 88.7091 102.51C90.4589 104.033 91.97 106.917 91.97 111.484C91.97 117.975 91.8905 123.183 91.8905 124.785C91.8905 126.067 92.7654 127.59 95.1515 127.109C114.24 120.699 128 102.59 128 81.1965C128.079 54.4342 106.525 32.8 80.0397 32.8Z" fill="black"/>
                    <path d="M50.2139 102.27C50.1343 102.51 49.7367 102.59 49.4185 102.43C49.1004 102.27 48.8618 101.949 49.0208 101.709C49.1004 101.469 49.4981 101.388 49.8162 101.549C50.1343 101.709 50.2934 102.029 50.2139 102.27Z" fill="black"/>
                    <path d="M52.1224 104.433C51.8837 104.674 51.4065 104.513 51.1679 104.193C50.8498 103.872 50.7702 103.392 51.0089 103.151C51.2475 102.911 51.6451 103.071 51.9633 103.392C52.2814 103.792 52.361 104.273 52.1224 104.433Z" fill="black"/>
                    <path d="M54.0314 107.238C53.7132 107.478 53.236 107.238 52.9974 106.837C52.6793 106.436 52.6793 105.876 52.9974 105.715C53.3155 105.475 53.7928 105.715 54.0314 106.116C54.3495 106.517 54.3495 106.997 54.0314 107.238Z" fill="black"/>
                    <path d="M56.656 109.962C56.4174 110.283 55.8607 110.202 55.3834 109.802C54.9858 109.401 54.8267 108.84 55.1448 108.6C55.3834 108.279 55.9402 108.359 56.4174 108.76C56.8151 109.081 56.8946 109.642 56.656 109.962Z" fill="black"/>
                    <path d="M60.2354 111.484C60.1558 111.885 59.5991 112.045 59.0423 111.885C58.4856 111.725 58.1674 111.244 58.247 110.924C58.3265 110.523 58.8832 110.363 59.44 110.523C59.9967 110.683 60.3149 111.084 60.2354 111.484Z" fill="black"/>
                    <path d="M64.1324 111.805C64.1324 112.206 63.6552 112.526 63.0984 112.526C62.5417 112.526 62.0645 112.206 62.0645 111.805C62.0645 111.404 62.5417 111.084 63.0984 111.084C63.6552 111.084 64.1324 111.404 64.1324 111.805Z" fill="black"/>
                    <path d="M67.791 111.164C67.8705 111.565 67.4729 111.965 66.9161 112.045C66.3594 112.125 65.8822 111.885 65.8026 111.484C65.7231 111.084 66.1208 110.683 66.6775 110.603C67.2343 110.523 67.7115 110.763 67.791 111.164Z" fill="black"/>
                    <path d="M190.125 70.1023H198.591C198.335 60.7841 190.097 54.0227 178.278 54.0227C166.602 54.0227 157.653 60.6989 157.653 70.7273C157.653 78.8239 163.449 83.5682 172.795 86.0966L179.67 87.9716C185.892 89.6193 190.693 91.6648 190.693 96.8352C190.693 102.517 185.267 106.267 177.795 106.267C171.034 106.267 165.409 103.256 164.898 96.9205H156.091C156.659 107.46 164.812 113.966 177.852 113.966C191.517 113.966 199.386 106.778 199.386 96.9205C199.386 86.4375 190.04 82.375 182.653 80.5568L176.972 79.0796C172.426 77.9148 166.375 75.7841 166.403 70.2159C166.403 65.2727 170.92 61.608 178.079 61.608C184.756 61.608 189.5 64.733 190.125 70.1023Z" fill="black"/>
                    <path d="M227.201 113.881C236.718 113.881 243.451 109.193 245.383 102.091L237.343 100.642C235.809 104.761 232.116 106.864 227.287 106.864C220.014 106.864 215.127 102.148 214.9 93.7386H245.923V90.7273C245.923 74.9602 236.491 68.7955 226.605 68.7955C214.446 68.7955 206.434 78.0568 206.434 91.4659C206.434 105.017 214.332 113.881 227.201 113.881ZM214.929 87.375C215.27 81.1818 219.758 75.8125 226.662 75.8125C233.252 75.8125 237.571 80.6989 237.599 87.375H214.929Z" fill="black"/>
                    <path d="M272.928 113.881C283.241 113.881 289.917 107.688 290.854 99.1932H282.587C281.508 103.909 277.843 106.693 272.985 106.693C265.798 106.693 261.167 100.699 261.167 91.1818C261.167 81.8352 265.883 75.9546 272.985 75.9546C278.383 75.9546 281.678 79.3636 282.587 83.4546H290.854C289.945 74.6477 282.758 68.7955 272.843 68.7955C260.542 68.7955 252.587 78.0568 252.587 91.3807C252.587 104.534 260.258 113.881 272.928 113.881Z" fill="black"/>
                    <path d="M326.78 94.9034C326.809 102.318 321.297 105.841 316.525 105.841C311.269 105.841 307.633 102.034 307.633 96.0966V69.3636H299.138V97.1193C299.138 107.943 305.076 113.568 313.456 113.568C320.019 113.568 324.479 110.102 326.496 105.443H326.951V113H335.303V69.3636H326.78V94.9034Z" fill="black"/>
                    <path d="M345.916 113H354.411V86.3523C354.411 80.6421 358.814 76.5227 364.837 76.5227C366.598 76.5227 368.587 76.8352 369.269 77.0341V68.9091C368.416 68.7955 366.74 68.7102 365.661 68.7102C360.547 68.7102 356.172 71.608 354.581 76.2955H354.127V69.3636H345.916V113Z" fill="black"/>
                    <path d="M375.82 113H384.314V69.3636H375.82V113ZM380.109 62.6307C383.035 62.6307 385.479 60.358 385.479 57.5739C385.479 54.7898 383.035 52.4886 380.109 52.4886C377.155 52.4886 374.74 54.7898 374.74 57.5739C374.74 60.358 377.155 62.6307 380.109 62.6307Z" fill="black"/>
                    <path d="M415.311 69.3636H406.362V58.9091H397.868V69.3636H391.475V76.1818H397.868V101.949C397.839 109.875 403.89 113.71 410.595 113.568C413.294 113.54 415.112 113.028 416.106 112.659L414.572 105.642C414.004 105.756 412.953 106.011 411.589 106.011C408.833 106.011 406.362 105.102 406.362 100.188V76.1818H415.311V69.3636Z" fill="black"/>
                    <path d="M429.276 129.25C436.293 129.25 440.754 125.585 443.254 118.824L461.293 69.4489L452.117 69.3636L441.066 103.227H440.612L429.56 69.3636H420.47L436.435 113.568L435.384 116.466C433.225 122.119 430.185 122.631 425.526 121.352L423.481 128.313C424.504 128.795 426.72 129.25 429.276 129.25Z" fill="black"/>
                    <path d="M489.551 113H524.693V105.443H498.33V54.8182H489.551V113Z" fill="black"/>
                    <path d="M545.925 113.966C553.141 113.966 557.203 110.301 558.822 107.034H559.163V113H567.459V84.0227C567.459 71.3239 557.459 68.7955 550.527 68.7955C542.629 68.7955 535.356 71.9773 532.516 79.9318L540.498 81.75C541.748 78.6534 544.93 75.6705 550.641 75.6705C556.123 75.6705 558.936 78.5398 558.936 83.483V83.6818C558.936 86.7784 555.754 86.7216 547.913 87.6307C539.646 88.5966 531.18 90.7557 531.18 100.67C531.18 109.25 537.629 113.966 545.925 113.966ZM547.771 107.148C542.97 107.148 539.504 104.989 539.504 100.784C539.504 96.2386 543.538 94.6193 548.453 93.9659C551.209 93.5966 557.743 92.858 558.964 91.6364V97.2614C558.964 102.432 554.845 107.148 547.771 107.148Z" fill="black"/>
                    <path d="M578.654 113H586.95V106.21H587.66C589.194 108.994 592.319 113.852 600.274 113.852C610.842 113.852 618.512 105.386 618.512 91.2671C618.512 77.1193 610.728 68.7955 600.189 68.7955C592.092 68.7955 589.166 73.7386 587.66 76.4375H587.149V54.8182H578.654V113ZM586.978 91.1818C586.978 82.0625 590.956 76.0114 598.37 76.0114C606.069 76.0114 609.933 82.5171 609.933 91.1818C609.933 99.9318 605.956 106.608 598.37 106.608C591.069 106.608 586.978 100.358 586.978 91.1818Z" fill="black"/>
                </svg>
                  
        </a>
    </div>            
        <div class="linkcontainer" id="linkcontainermenu">
                <div class="linkbar">
                    <a href="https://help.semmle.com/QL/learn-ql/">Learn CodeQL</a>
                    <a href="https://help.semmle.com/codeql/codeql-tools.html">CodeQL tools</a>
                    <a href="https://github.com/github/codeql">CodeQL repository</a>
                    <a href="https://help.semmle.com/QL/ql-libraries.html">CodeQL libraries</a>
                    <a href="javascript:void(0);" class="icon" onclick="myFunction()">
                        <i class="fa fa-bars"></i>
                      </a>
                </div>
       </div>
</div>  
<div id="title-banner">
    <a href="../index.html">Learning CodeQL</a>
    <div id="searchbox-title-banner" role="search">
            <form class="search" action="../search.html" method="get">
                <div id="textfield"><input type="text" name="q" /></div>
                <div id="searchbutton"><input type="submit" value="Search" /></div>
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
        </div>
        <script type="text/javascript">$('#searchbox').show(0);</script> 
    <div class="clearer"></div>
</div>

<div class="wrapper">
   
    <div class="navBox" > 
            <div id="searchbox-navbar"  role="search">
                    <form class="search" action="../search.html" method="get">
                        <div id="textfield"><input type="text" name="q" /></div>
                        <div id="searchbutton"><input type="submit" value="Search" /></div>
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                    </form>
                </div>
                <script type="text/javascript">$('#searchbox').show(0);</script> 
                <div class="clearer"></div>
            <div id="toc">
                <h1>Contents</h1>  
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../beginner/ql-tutorials.html">QL tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-queries/writing-queries.html">CodeQL queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/ql-for-cpp.html">CodeQL for C and C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../csharp/ql-for-csharp.html">CodeQL for C#</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/ql-for-go.html">CodeQL for Go</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ql-for-java.html">CodeQL for Java</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic-query-java.html">Basic query for Java code</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">CodeQL library for Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataflow.html">Analyzing data flow in Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="types-class-hierarchy.html">Java types</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions-statements.html">Overflow-prone comparisons in Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="call-graph.html">Navigating the call graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html">Annotations in Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="javadoc.html">Javadoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="source-locations.html">Working with source locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="ast-class-reference.html">Abstract syntax tree classes for working with Java programs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javascript/ql-for-javascript.html">CodeQL for JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/ql-for-python.html">CodeQL for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ql-training.html">CodeQL training and variant analysis examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology-note.html">Recent terminology changes</a></li>
</ul>

            </div>
    </div>
    <div class="mainBox">
        
  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="codeql-library-for-java">
<h1>CodeQL library for Java<a class="headerlink" href="#codeql-library-for-java" title="Permalink to this headline">¶</a></h1>
<p>When you’re analyzing a Java program, you can make use of the large collection of classes in the CodeQL library for Java.</p>
<div class="section" id="about-the-codeql-library-for-java">
<h2>About the CodeQL library for Java<a class="headerlink" href="#about-the-codeql-library-for-java" title="Permalink to this headline">¶</a></h2>
<p>There is an extensive library for analyzing CodeQL databases extracted from Java projects. The classes in this library present the data from a database in an object-oriented form and provide abstractions and predicates to help you with common analysis tasks.</p>
<p>The library is implemented as a set of QL modules, that is, files with the extension <code class="docutils literal"><span class="pre">.qll</span></code>. The module <code class="docutils literal"><span class="pre">java.qll</span></code> imports all the core Java library modules, so you can include the complete library by beginning your query with:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>
</pre></div>
</div>
<p>The rest of this article briefly summarizes the most important classes and predicates provided by this library.</p>
<blockquote class="pull-quote">
<div><p>Note</p>
<p>The example queries in this article illustrate the types of results returned by different library classes. The results themselves are not interesting but can be used as the basis for developing a more complex query. The other articles in this section of the help show how you can take a simple query and fine-tune it to find precisely the results you’re interested in.</p>
</div></blockquote>
</div>
<div class="section" id="summary-of-the-library-classes">
<h2>Summary of the library classes<a class="headerlink" href="#summary-of-the-library-classes" title="Permalink to this headline">¶</a></h2>
<p>The most important classes in the standard Java library can be grouped into five main categories:</p>
<ol class="arabic simple">
<li>Classes for representing program elements (such as classes and methods)</li>
<li>Classes for representing AST nodes (such as statements and expressions)</li>
<li>Classes for representing metadata (such as annotations and comments)</li>
<li>Classes for computing metrics (such as cyclomatic complexity and coupling)</li>
<li>Classes for navigating the program’s call graph</li>
</ol>
<p>We will discuss each of these in turn, briefly describing the most important classes for each category.</p>
</div>
<div class="section" id="program-elements">
<h2>Program elements<a class="headerlink" href="#program-elements" title="Permalink to this headline">¶</a></h2>
<p>These classes represent named program elements: packages (<code class="docutils literal"><span class="pre">Package</span></code>), compilation units (<code class="docutils literal"><span class="pre">CompilationUnit</span></code>), types (<code class="docutils literal"><span class="pre">Type</span></code>), methods (<code class="docutils literal"><span class="pre">Method</span></code>), constructors (<code class="docutils literal"><span class="pre">Constructor</span></code>), and variables (<code class="docutils literal"><span class="pre">Variable</span></code>).</p>
<p>Their common superclass is <code class="docutils literal"><span class="pre">Element</span></code>, which provides general member predicates for determining the name of a program element and checking whether two elements are nested inside each other.</p>
<p>It’s often convenient to refer to an element that might either be a method or a constructor; the class <code class="docutils literal"><span class="pre">Callable</span></code>, which is a common superclass of <code class="docutils literal"><span class="pre">Method</span></code> and <code class="docutils literal"><span class="pre">Constructor</span></code>, can be used for this purpose.</p>
<div class="section" id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p>Class <code class="docutils literal"><span class="pre">Type</span></code> has a number of subclasses for representing different kinds of types:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">PrimitiveType</span></code> represents a <a class="reference external" href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">primitive type</a>, that is, one of <code class="docutils literal"><span class="pre">boolean</span></code>, <code class="docutils literal"><span class="pre">byte</span></code>, <code class="docutils literal"><span class="pre">char</span></code>, <code class="docutils literal"><span class="pre">double</span></code>, <code class="docutils literal"><span class="pre">float</span></code>, <code class="docutils literal"><span class="pre">int</span></code>, <code class="docutils literal"><span class="pre">long</span></code>, <code class="docutils literal"><span class="pre">short</span></code>; QL also classifies <code class="docutils literal"><span class="pre">void</span></code> and <code class="docutils literal"><span class="pre">&lt;nulltype&gt;</span></code> (the type of the <code class="docutils literal"><span class="pre">null</span></code> literal) as primitive types.</li>
<li><code class="docutils literal"><span class="pre">RefType</span></code> represents a reference (that is, non-primitive) type; it in turn has several subclasses:<ul>
<li><code class="docutils literal"><span class="pre">Class</span></code> represents a Java class.</li>
<li><code class="docutils literal"><span class="pre">Interface</span></code> represents a Java interface.</li>
<li><code class="docutils literal"><span class="pre">EnumType</span></code> represents a Java <code class="docutils literal"><span class="pre">enum</span></code> type.</li>
<li><code class="docutils literal"><span class="pre">Array</span></code> represents a Java array type.</li>
</ul>
</li>
</ul>
<p>For example, the following query finds all variables of type <code class="docutils literal"><span class="pre">int</span></code> in the program:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Variable</span> <span class="n">v</span><span class="p">,</span> <span class="n">PrimitiveType</span> <span class="n">pt</span>
<span class="k">where</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">getType</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">pt</span><span class="p">.</span><span class="n">hasName</span><span class="p">(</span><span class="s">&quot;int&quot;</span><span class="p">)</span>
<span class="k">select</span> <span class="n">v</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/860076406167044435/">See this in the query console on LGTM.com</a>. You’re likely to get many results when you run this query because most projects contain many variables of type <code class="docutils literal"><span class="pre">int</span></code>.</p>
<p>Reference types are also categorized according to their declaration scope:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TopLevelType</span></code> represents a reference type declared at the top-level of a compilation unit.</li>
<li><code class="docutils literal"><span class="pre">NestedType</span></code> is a type declared inside another type.</li>
</ul>
<p>For instance, this query finds all top-level types whose name is not the same as that of their compilation unit:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">TopLevelType</span> <span class="n">tl</span>
<span class="k">where</span> <span class="n">tl</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">!=</span> <span class="n">tl</span><span class="p">.</span><span class="n">getCompilationUnit</span><span class="p">().</span><span class="n">getName</span><span class="p">()</span>
<span class="k">select</span> <span class="n">tl</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/4340983612585284460/">See this in the query console on LGTM.com</a>. This pattern is seen in many projects. When we ran it on the LGTM.com demo projects, most of the projects had at least one instance of this problem in the source code. There were many more instances in the files referenced by the source code.</p>
<p>Several more specialized classes are available as well:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TopLevelClass</span></code> represents a class declared at the top-level of a compilation unit.</li>
<li><code class="docutils literal"><span class="pre">NestedClass</span></code> represents <a class="reference external" href="https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html">a class declared inside another type</a>, such as:<ul>
<li>A <code class="docutils literal"><span class="pre">LocalClass</span></code>, which is <a class="reference external" href="https://docs.oracle.com/javase/tutorial/java/javaOO/localclasses.html">a class declared inside a method or constructor</a>.</li>
<li>An <code class="docutils literal"><span class="pre">AnonymousClass</span></code>, which is an <a class="reference external" href="https://docs.oracle.com/javase/tutorial/java/javaOO/anonymousclasses.html">anonymous class</a>.</li>
</ul>
</li>
</ul>
<p>Finally, the library also has a number of singleton classes that wrap frequently used Java standard library classes: <code class="docutils literal"><span class="pre">TypeObject</span></code>, <code class="docutils literal"><span class="pre">TypeCloneable</span></code>, <code class="docutils literal"><span class="pre">TypeRuntime</span></code>, <code class="docutils literal"><span class="pre">TypeSerializable</span></code>, <code class="docutils literal"><span class="pre">TypeString</span></code>, <code class="docutils literal"><span class="pre">TypeSystem</span></code> and <code class="docutils literal"><span class="pre">TypeClass</span></code>. Each CodeQL class represents the standard Java class suggested by its name.</p>
<p>As an example, we can write a query that finds all nested classes that directly extend <code class="docutils literal"><span class="pre">Object</span></code>:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">NestedClass</span> <span class="n">nc</span>
<span class="k">where</span> <span class="n">nc</span><span class="p">.</span><span class="n">getASupertype</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">TypeObject</span>
<span class="k">select</span> <span class="n">nc</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/8482509736206423238/">See this in the query console on LGTM.com</a>. You’re likely to get many results when you run this query because many projects include nested classes that extend <code class="docutils literal"><span class="pre">Object</span></code> directly.</p>
</div>
<div class="section" id="generics">
<h3>Generics<a class="headerlink" href="#generics" title="Permalink to this headline">¶</a></h3>
<p>There are also several subclasses of <code class="docutils literal"><span class="pre">Type</span></code> for dealing with generic types.</p>
<p>A <code class="docutils literal"><span class="pre">GenericType</span></code> is either a <code class="docutils literal"><span class="pre">GenericInterface</span></code> or a <code class="docutils literal"><span class="pre">GenericClass</span></code>. It represents a generic type declaration such as interface <code class="docutils literal"><span class="pre">java.util.Map</span></code> from the Java standard library:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">java.util.</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">size</span><span class="o">();</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Type parameters, such as <code class="docutils literal"><span class="pre">K</span></code> and <code class="docutils literal"><span class="pre">V</span></code> in this example, are represented by class <code class="docutils literal"><span class="pre">TypeVariable</span></code>.</p>
<p>A parameterized instance of a generic type provides a concrete type to instantiate the type parameter with, as in <code class="docutils literal"><span class="pre">Map&lt;String,</span> <span class="pre">File&gt;</span></code>. Such a type is represented by a <code class="docutils literal"><span class="pre">ParameterizedType</span></code>, which is distinct from the <code class="docutils literal"><span class="pre">GenericType</span></code> representing the generic type it was instantiated from. To go from a <code class="docutils literal"><span class="pre">ParameterizedType</span></code> to its corresponding <code class="docutils literal"><span class="pre">GenericType</span></code>, you can use predicate <code class="docutils literal"><span class="pre">getSourceDeclaration</span></code>.</p>
<p>For instance, we could use the following query to find all parameterized instances of <code class="docutils literal"><span class="pre">java.util.Map</span></code>:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">GenericInterface</span> <span class="n">map</span><span class="p">,</span> <span class="n">ParameterizedType</span> <span class="n">pt</span>
<span class="k">where</span> <span class="n">map</span><span class="p">.</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s">&quot;java.util&quot;</span><span class="p">,</span> <span class="s">&quot;Map&quot;</span><span class="p">)</span> <span class="k">and</span>
    <span class="n">pt</span><span class="p">.</span><span class="n">getSourceDeclaration</span><span class="p">()</span> <span class="o">=</span> <span class="n">map</span>
<span class="k">select</span> <span class="n">pt</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/7863873821043873550/">See this in the query console on LGTM.com</a>. None of the LGTM.com demo projects contain parameterized instances of <code class="docutils literal"><span class="pre">java.util.Map</span></code> in their source code, but they all have results in reference files.</p>
<p>In general, generic types may restrict which types a type parameter can be bound to. For instance, a type of maps from strings to numbers could be declared as follows:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">StringToNumMap</span><span class="o">&lt;</span><span class="n">N</span> <span class="kd">extends</span> <span class="n">Number</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">N</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This means that a parameterized instance of <code class="docutils literal"><span class="pre">StringToNumberMap</span></code> can only instantiate type parameter <code class="docutils literal"><span class="pre">N</span></code> with type <code class="docutils literal"><span class="pre">Number</span></code> or one of its subtypes but not, for example, with <code class="docutils literal"><span class="pre">File</span></code>. We say that N is a bounded type parameter, with <code class="docutils literal"><span class="pre">Number</span></code> as its upper bound. In QL, a type variable can be queried for its type bound using predicate <code class="docutils literal"><span class="pre">getATypeBound</span></code>. The type bounds themselves are represented by class <code class="docutils literal"><span class="pre">TypeBound</span></code>, which has a member predicate <code class="docutils literal"><span class="pre">getType</span></code> to retrieve the type the variable is bounded by.</p>
<p>As an example, the following query finds all type variables with type bound <code class="docutils literal"><span class="pre">Number</span></code>:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">TypeVariable</span> <span class="n">tv</span><span class="p">,</span> <span class="n">TypeBound</span> <span class="n">tb</span>
<span class="k">where</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">tv</span><span class="p">.</span><span class="n">getATypeBound</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">tb</span><span class="p">.</span><span class="n">getType</span><span class="p">().</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s">&quot;java.lang&quot;</span><span class="p">,</span> <span class="s">&quot;Number&quot;</span><span class="p">)</span>
<span class="k">select</span> <span class="n">tv</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/6740696080876162817/">See this in the query console on LGTM.com</a>. When we ran it on the LGTM.com demo projects, the <em>neo4j/neo4j</em>, <em>hibernate/hibernate-orm</em> and <em>apache/hadoop</em> projects all contained examples of this pattern.</p>
<p>For dealing with legacy code that is unaware of generics, every generic type has a “raw” version without any type parameters. In the CodeQL libraries, raw types are represented using class <code class="docutils literal"><span class="pre">RawType</span></code>, which has the expected subclasses <code class="docutils literal"><span class="pre">RawClass</span></code> and <code class="docutils literal"><span class="pre">RawInterface</span></code>. Again, there is a predicate <code class="docutils literal"><span class="pre">getSourceDeclaration</span></code> for obtaining the corresponding generic type. As an example, we can find variables of (raw) type <code class="docutils literal"><span class="pre">Map</span></code>:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Variable</span> <span class="n">v</span><span class="p">,</span> <span class="n">RawType</span> <span class="n">rt</span>
<span class="k">where</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">getType</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">rt</span><span class="p">.</span><span class="n">getSourceDeclaration</span><span class="p">().</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s">&quot;java.util&quot;</span><span class="p">,</span> <span class="s">&quot;Map&quot;</span><span class="p">)</span>
<span class="k">select</span> <span class="n">v</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/4032913402499547882/">See this in the query console on LGTM.com</a>. Many projects have variables of raw type <code class="docutils literal"><span class="pre">Map</span></code>.</p>
<p>For example, in the following code snippet this query would find <code class="docutils literal"><span class="pre">m1</span></code>, but not <code class="docutils literal"><span class="pre">m2</span></code>:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span> <span class="n">m1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">m2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</pre></div>
</div>
<p>Finally, variables can be declared to be of a <a class="reference external" href="https://docs.oracle.com/javase/tutorial/java/generics/wildcards.html">wildcard type</a>:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Number</span><span class="o">,</span> <span class="o">?</span> <span class="kd">super</span> <span class="n">Float</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">;</span>
</pre></div>
</div>
<p>The wildcards <code class="docutils literal"><span class="pre">?</span> <span class="pre">extends</span> <span class="pre">Number</span></code> and <code class="docutils literal"><span class="pre">?</span> <span class="pre">super</span> <span class="pre">Float</span></code> are represented by class <code class="docutils literal"><span class="pre">WildcardTypeAccess</span></code>. Like type parameters, wildcards may have type bounds. Unlike type parameters, wildcards can have upper bounds (as in <code class="docutils literal"><span class="pre">?</span> <span class="pre">extends</span> <span class="pre">Number</span></code>), and also lower bounds (as in <code class="docutils literal"><span class="pre">?</span> <span class="pre">super</span> <span class="pre">Float</span></code>). Class <code class="docutils literal"><span class="pre">WildcardTypeAccess</span></code> provides member predicates <code class="docutils literal"><span class="pre">getUpperBound</span></code> and <code class="docutils literal"><span class="pre">getLowerBound</span></code> to retrieve the upper and lower bounds, respectively.</p>
<p>For dealing with generic methods, there are classes <code class="docutils literal"><span class="pre">GenericMethod</span></code>, <code class="docutils literal"><span class="pre">ParameterizedMethod</span></code> and <code class="docutils literal"><span class="pre">RawMethod</span></code>, which are entirely analogous to the like-named classes for representing generic types.</p>
<p>For more information on working with types, see the <a class="reference internal" href="types-class-hierarchy.html"><span class="doc">article on Java types</span></a>.</p>
</div>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>Class <code class="docutils literal"><span class="pre">Variable</span></code> represents a variable <a class="reference external" href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/variables.html">in the Java sense</a>, which is either a member field of a class (whether static or not), or a local variable, or a parameter. Consequently, there are three subclasses catering to these special cases:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Field</span></code> represents a Java field.</li>
<li><code class="docutils literal"><span class="pre">LocalVariableDecl</span></code> represents a local variable.</li>
<li><code class="docutils literal"><span class="pre">Parameter</span></code> represents a parameter of a method or constructor.</li>
</ul>
</div>
</div>
<div class="section" id="abstract-syntax-tree">
<h2>Abstract syntax tree<a class="headerlink" href="#abstract-syntax-tree" title="Permalink to this headline">¶</a></h2>
<p>Classes in this category represent abstract syntax tree (AST) nodes, that is, statements (class <code class="docutils literal"><span class="pre">Stmt</span></code>) and expressions (class <code class="docutils literal"><span class="pre">Expr</span></code>). For a full list of expression and statement types available in the standard QL library, see “<a class="reference internal" href="ast-class-reference.html"><span class="doc">Abstract syntax tree classes for working with Java programs</span></a>.”</p>
<p>Both <code class="docutils literal"><span class="pre">Expr</span></code> and <code class="docutils literal"><span class="pre">Stmt</span></code> provide member predicates for exploring the abstract syntax tree of a program:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Expr.getAChildExpr</span></code> returns a sub-expression of a given expression.</li>
<li><code class="docutils literal"><span class="pre">Stmt.getAChild</span></code> returns a statement or expression that is nested directly inside a given statement.</li>
<li><code class="docutils literal"><span class="pre">Expr.getParent</span></code> and <code class="docutils literal"><span class="pre">Stmt.getParent</span></code> return the parent node of an AST node.</li>
</ul>
<p>For example, the following query finds all expressions whose parents are <code class="docutils literal"><span class="pre">return</span></code> statements:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Expr</span> <span class="n">e</span>
<span class="k">where</span> <span class="n">e</span><span class="p">.</span><span class="n">getParent</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">ReturnStmt</span>
<span class="k">select</span> <span class="n">e</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/1947757851560375919/">See this in the query console on LGTM.com</a>. Many projects have examples of <code class="docutils literal"><span class="pre">return</span></code> statements with child expressions.</p>
<p>Therefore, if the program contains a return statement <code class="docutils literal"><span class="pre">return</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y;</span></code>, this query will return <code class="docutils literal"><span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code>.</p>
<p>As another example, the following query finds statements whose parent is an <code class="docutils literal"><span class="pre">if</span></code> statement:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Stmt</span> <span class="n">s</span>
<span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">getParent</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">IfStmt</span>
<span class="k">select</span> <span class="n">s</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/1989464153689219612/">See this in the query console on LGTM.com</a>. Many projects have examples of <code class="docutils literal"><span class="pre">if</span></code> statements with child statements.</p>
<p>This query will find both <code class="docutils literal"><span class="pre">then</span></code> branches and <code class="docutils literal"><span class="pre">else</span></code> branches of all <code class="docutils literal"><span class="pre">if</span></code> statements in the program.</p>
<p>Finally, here is a query that finds method bodies:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Stmt</span> <span class="n">s</span>
<span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">getParent</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">Method</span>
<span class="k">select</span> <span class="n">s</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/1016821702972128245/">See this in the query console on LGTM.com</a>. Most projects have many method bodies.</p>
<p>As these examples show, the parent node of an expression is not always an expression: it may also be a statement, for example, an <code class="docutils literal"><span class="pre">IfStmt</span></code>. Similarly, the parent node of a statement is not always a statement: it may also be a method or a constructor. To capture this, the QL Java library provides two abstract class <code class="docutils literal"><span class="pre">ExprParent</span></code> and <code class="docutils literal"><span class="pre">StmtParent</span></code>, the former representing any node that may be the parent node of an expression, and the latter any node that may be the parent node of a statement.</p>
<p>For more information on working with AST classes, see the <a class="reference internal" href="expressions-statements.html"><span class="doc">article on overflow-prone comparisons in Java</span></a>.</p>
</div>
<div class="section" id="metadata">
<h2>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h2>
<p>Java programs have several kinds of metadata, in addition to the program code proper. In particular, there are <a class="reference external" href="https://docs.oracle.com/javase/tutorial/java/annotations/">annotations</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Javadoc">Javadoc</a> comments. Since this metadata is interesting both for enhancing code analysis and as an analysis subject in its own right, the QL library defines classes for accessing it.</p>
<p>For annotations, class <code class="docutils literal"><span class="pre">Annotatable</span></code> is a superclass of all program elements that can be annotated. This includes packages, reference types, fields, methods, constructors, and local variable declarations. For every such element, its predicate <code class="docutils literal"><span class="pre">getAnAnnotation</span></code> allows you to retrieve any annotations the element may have. For example, the following query finds all annotations on constructors:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Constructor</span> <span class="n">c</span>
<span class="k">select</span> <span class="n">c</span><span class="p">.</span><span class="n">getAnAnnotation</span><span class="p">()</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/3206112561297137365/">See this in the query console on LGTM.com</a>. The LGTM.com demo projects all use annotations, you can see examples where they are used to suppress warnings and mark code as deprecated.</p>
<p>These annotations are represented by class <code class="docutils literal"><span class="pre">Annotation</span></code>. An annotation is simply an expression whose type is an <code class="docutils literal"><span class="pre">AnnotationType</span></code>. For example, you can amend this query so that it only reports deprecated constructors:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Constructor</span> <span class="n">c</span><span class="p">,</span> <span class="n">Annotation</span> <span class="n">ann</span><span class="p">,</span> <span class="n">AnnotationType</span> <span class="n">anntp</span>
<span class="k">where</span> <span class="n">ann</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">getAnAnnotation</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">anntp</span> <span class="o">=</span> <span class="n">ann</span><span class="p">.</span><span class="n">getType</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">anntp</span><span class="p">.</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s">&quot;java.lang&quot;</span><span class="p">,</span> <span class="s">&quot;Deprecated&quot;</span><span class="p">)</span>
<span class="k">select</span> <span class="n">ann</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/5393027107459215059/">See this in the query console on LGTM.com</a>. Only constructors with the <code class="docutils literal"><span class="pre">&#64;Deprecated</span></code> annotation are reported this time.</p>
<p>For more information on working with annotations, see the <a class="reference internal" href="annotations.html"><span class="doc">article on annotations</span></a>.</p>
<p>For Javadoc, class <code class="docutils literal"><span class="pre">Element</span></code> has a member predicate <code class="docutils literal"><span class="pre">getDoc</span></code> that returns a delegate <code class="docutils literal"><span class="pre">Documentable</span></code> object, which can then be queried for its attached Javadoc comments. For example, the following query finds Javadoc comments on private fields:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Field</span> <span class="n">f</span><span class="p">,</span> <span class="n">Javadoc</span> <span class="n">jdoc</span>
<span class="k">where</span> <span class="n">f</span><span class="p">.</span><span class="n">isPrivate</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">jdoc</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">getDoc</span><span class="p">().</span><span class="n">getJavadoc</span><span class="p">()</span>
<span class="k">select</span> <span class="n">jdoc</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/6022769142134600659/">See this in the query console on LGTM.com</a>. You can see this pattern in many projects.</p>
<p>Class <code class="docutils literal"><span class="pre">Javadoc</span></code> represents an entire Javadoc comment as a tree of <code class="docutils literal"><span class="pre">JavadocElement</span></code> nodes, which can be traversed using member predicates <code class="docutils literal"><span class="pre">getAChild</span></code> and <code class="docutils literal"><span class="pre">getParent</span></code>. For instance, you could edit the query so that it finds all <code class="docutils literal"><span class="pre">&#64;author</span></code> tags in Javadoc comments on private fields:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Field</span> <span class="n">f</span><span class="p">,</span> <span class="n">Javadoc</span> <span class="n">jdoc</span><span class="p">,</span> <span class="n">AuthorTag</span> <span class="n">at</span>
<span class="k">where</span> <span class="n">f</span><span class="p">.</span><span class="n">isPrivate</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">jdoc</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">getDoc</span><span class="p">().</span><span class="n">getJavadoc</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">at</span><span class="p">.</span><span class="n">getParent</span><span class="o">+</span><span class="p">()</span> <span class="o">=</span> <span class="n">jdoc</span>
<span class="k">select</span> <span class="n">at</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/2510220694395289111/">See this in the query console on LGTM.com</a>. None of the LGTM.com demo projects uses the <code class="docutils literal"><span class="pre">&#64;author</span></code> tag on private fields.</p>
<blockquote class="pull-quote">
<div><p>Note</p>
<p>On line 5 we used <code class="docutils literal"><span class="pre">getParent+</span></code> to capture tags that are nested at any depth within the Javadoc comment.</p>
</div></blockquote>
<p>For more information on working with Javadoc, see the <a class="reference internal" href="javadoc.html"><span class="doc">article on Javadoc</span></a>.</p>
</div>
<div class="section" id="metrics">
<h2>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h2>
<p>The standard QL Java library provides extensive support for computing metrics on Java program elements. To avoid overburdening the classes representing those elements with too many member predicates related to metric computations, these predicates are made available on delegate classes instead.</p>
<p>Altogether, there are six such classes: <code class="docutils literal"><span class="pre">MetricElement</span></code>, <code class="docutils literal"><span class="pre">MetricPackage</span></code>, <code class="docutils literal"><span class="pre">MetricRefType</span></code>, <code class="docutils literal"><span class="pre">MetricField</span></code>, <code class="docutils literal"><span class="pre">MetricCallable</span></code>, and <code class="docutils literal"><span class="pre">MetricStmt</span></code>. The corresponding element classes each provide a member predicate <code class="docutils literal"><span class="pre">getMetrics</span></code> that can be used to obtain an instance of the delegate class, on which metric computations can then be performed.</p>
<p>For example, the following query finds methods with a <a class="reference external" href="https://en.wikipedia.org/wiki/Cyclomatic_complexity">cyclomatic complexity</a> greater than 40:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Method</span> <span class="n">m</span><span class="p">,</span> <span class="n">MetricCallable</span> <span class="n">mc</span>
<span class="k">where</span> <span class="n">mc</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">getMetrics</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">mc</span><span class="p">.</span><span class="n">getCyclomaticComplexity</span><span class="p">()</span> <span class="o">&gt;</span> <span class="m">40</span>
<span class="k">select</span> <span class="n">m</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/6566950741051181919/">See this in the query console on LGTM.com</a>. Most large projects include some methods with a very high cyclomatic complexity. These methods are likely to be difficult to understand and test.</p>
</div>
<div class="section" id="call-graph">
<h2>Call graph<a class="headerlink" href="#call-graph" title="Permalink to this headline">¶</a></h2>
<p>CodeQL databases generated from Java code bases include precomputed information about the program’s call graph, that is, which methods or constructors a given call may dispatch to at runtime.</p>
<p>The class <code class="docutils literal"><span class="pre">Callable</span></code>, introduced above, includes both methods and constructors. Call expressions are abstracted using class <code class="docutils literal"><span class="pre">Call</span></code>, which includes method calls, <code class="docutils literal"><span class="pre">new</span></code> expressions, and explicit constructor calls using <code class="docutils literal"><span class="pre">this</span></code> or <code class="docutils literal"><span class="pre">super</span></code>.</p>
<p>We can use predicate <code class="docutils literal"><span class="pre">Call.getCallee</span></code> to find out which method or constructor a specific call expression refers to. For example, the following query finds all calls to methods called <code class="docutils literal"><span class="pre">println</span></code>:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Call</span> <span class="n">c</span><span class="p">,</span> <span class="n">Method</span> <span class="n">m</span>
<span class="k">where</span> <span class="n">m</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">getCallee</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">m</span><span class="p">.</span><span class="n">hasName</span><span class="p">(</span><span class="s">&quot;println&quot;</span><span class="p">)</span>
<span class="k">select</span> <span class="n">c</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/5861255162551917595/">See this in the query console on LGTM.com</a>. The LGTM.com demo projects all include many calls to methods of this name.</p>
<p>Conversely, <code class="docutils literal"><span class="pre">Callable.getAReference</span></code> returns a <code class="docutils literal"><span class="pre">Call</span></code> that refers to it. So we can find methods and constructors that are never called using this query:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">java</span>

<span class="k">from</span> <span class="n">Callable</span> <span class="n">c</span>
<span class="k">where</span> <span class="k">not</span> <span class="k">exists</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">getAReference</span><span class="p">())</span>
<span class="k">select</span> <span class="n">c</span>
</pre></div>
</div>
<p>➤ <a class="reference external" href="https://lgtm.com/query/7261739919657747703/">See this in the query console on LGTM.com</a>. The LGTM.com demo projects all appear to have many methods that are not called directly, but this is unlikely to be the whole story. To explore this area further, see “<a class="reference internal" href="call-graph.html"><span class="doc">Navigating the call graph</span></a>.”</p>
<p>For more information about callables and calls, see the <a class="reference internal" href="call-graph.html"><span class="doc">article on the call graph</span></a>.</p>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/github/codeql/tree/main/java/ql/src">CodeQL queries for Java</a></li>
<li><a class="reference external" href="https://github.com/github/codeql/tree/main/java/ql/examples">Example queries for Java</a></li>
<li><a class="reference external" href="https://help.semmle.com/qldoc/java/">CodeQL library reference for Java</a></li>
</ul>
<ul class="simple">
<li>“<a class="reference external" href="https://help.semmle.com/QL/ql-handbook">QL language reference</a>”</li>
<li>“<a class="reference external" href="https://help.semmle.com/codeql/codeql-tools.html">CodeQL tools</a>”</li>
</ul>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    </div>
    <div class="privacy">
            <a target="_blank" href="https://help.semmle.com/privacy-policy.html" alt="Privacy policy and tracking preferences" title="Privacy policy and tracking preferences">Privacy policy</a>
    </div>
    
</div>


 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .name").show();
        $(".toggle .name").click(function() {
            $(this).parent().children().not(".name").toggle(400);
            $(this).parent().children(".name").toggleClass("open");
        })
    });
</script>

  </body>
</html>