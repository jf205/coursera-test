
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Find the thief &#8212; Learn CodeQL</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.25',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Catch the fire starter" href="catch-the-fire-starter.html" />
    <link rel="prev" title="Introduction to QL" href="../introduction-to-ql.html" />

<title>CodeQL docs</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="../_static/custom.css" type="text/css" />
<link rel="stylesheet" href="../_static/primer.css" type="text/css" />


  </head>
  <body>
<header class="Header">
    <div class="Header-item--full">
        <a href="../index.html" class="Header-link f2 d-flex flex-items-center">
            <!-- <%= octicon "mark-github", class: "mr-2", height: 32 %> -->
            <svg height="32" class="octicon octicon-mark-github mr-2" viewBox="0 0 16 16" version="1.1" width="32"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
            <span class="hide-sm">Learning CodeQL</span>
        </a>
    </div>
    <div class="Header-item hide-sm hide-md">
        <form class="search" action="../search.html" method="get">
            <input class="form-control input-dark" type="text" name="q" placeholder="Search" />
            <input class="btn" type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
        <script type="text/javascript">$('#searchbox').show(0);</script>

        <div class="clearer"></div>
    </div>
    <div class="Header-item">

        <details class="dropdown details-reset details-overlay d-inline-block">
            <summary class="btn bg-gray-dark text-white border" aria-haspopup="true">
                CodeQL resources
                <div class="dropdown-caret"></div>
            </summary>

            <ul class="dropdown-menu dropdown-menu-se dropdown-menu-dark">
                <div class="dropdown-header">
                    Help docs
                </div>
                <li><a class="dropdown-item" href="https://help.semmle.com/QL/learn-ql/">Learn CodeQL</a></li>
                <li><a class="dropdown-item" href="https://help.semmle.com/codeql/codeql-tools.html">CodeQL tools</a>
                </li>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Reference docs
                </div>
                <li><a class="dropdown-item" href="https://help.semmle.com/QL/ql-handbook/">QL language reference</a>
                <li><a class="dropdown-item" href="https://help.semmle.com/QL/ql-libraries.html">CodeQL libraries</a>
                <li><a class="dropdown-item" href="https://help.semmle.com/QL/ql-built-in-queries.html">CodeQL
                        queries</a>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Source files
                </div>
                <li><a class="dropdown-item" href="https://github.com/github/codeql">CodeQL repository</a>
            </ul>
        </details>

    </div>

</header>
<main class="bg-gray-light clearfix">
<nav class="SideNav position-sticky top-0 col-lg-3 col-md-3 float-left p-4 hide-sm hide-md overflow-y-auto">

    <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="ql-tutorials.html">QL tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction-to-ql.html">Introduction to QL</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Find the thief</a></li>
<li class="toctree-l2"><a class="reference internal" href="catch-the-fire-starter.html">Catch the fire starter</a></li>
<li class="toctree-l2"><a class="reference internal" href="crown-the-rightful-heir.html">Crown the rightful heir</a></li>
<li class="toctree-l2"><a class="reference internal" href="cross-the-river.html">Cross the river</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../writing-queries/writing-queries.html">CodeQL queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/ql-for-cpp.html">CodeQL for C and C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../csharp/ql-for-csharp.html">CodeQL for C#</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/ql-for-go.html">CodeQL for Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java/ql-for-java.html">CodeQL for Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javascript/ql-for-javascript.html">CodeQL for JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/ql-for-python.html">CodeQL for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ql-training.html">CodeQL training and variant analysis examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology-note.html">Recent terminology changes</a></li>
</ul>


</nav>


<div class="body col-sm-12 col-md-9 col-lg-9 float-left border-left">

    <div class="hide-lg hide-xl px-4 pt-4">
        
<div class="related" role="navigation" aria-label="related navigation">
    <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Learn CodeQL</a> &#187;</li>
        <li class="nav-item nav-item-1"><a href="ql-tutorials.html"
                accesskey="U">QL tutorials</a> &#187;</li> 
    </ul>
</div>
    </div>

    <article class="p-4 col-lg-10 col-md-10 col-sm-12">
        
  <div class="section" id="find-the-thief">
<h1>Find the thief<a class="headerlink" href="#find-the-thief" title="Permalink to this headline">¶</a></h1>
<p>Take on the role of a detective to find the thief in this fictional village. You will learn how to use logical connectives, quantifiers, and aggregates in QL along the way.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>There is a small village hidden away in the mountains. The village is divided into four parts—north, south, east, and west—and in the center stands a dark and mysterious castle… Inside the castle, locked away in the highest tower, lies the king’s valuable golden crown. One night, a terrible crime is committed. A thief breaks into the tower and steals the crown!</p>
<p>You know that the thief must live in the village, since nobody else knew about the crown. After some expert detective work, you obtain a list of all the people in the village and some of their personal details.</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="12%" />
<col width="29%" />
<col width="20%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Age</th>
<th class="head">Hair color</th>
<th class="head">Height</th>
<th class="head">Location</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Sadly, you still have no idea who could have stolen the crown so you walk around the village to find clues. The villagers act very suspiciously and you are convinced they have information about the thief. They refuse to share their knowledge with you directly, but they reluctantly agree to answer questions. They are still not very talkative and <strong>only answer questions with ‘yes’ or ‘no’</strong>.</p>
<p>You start asking some creative questions and making notes of the answers so you can compare them with your information later:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="83%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">Question</th>
<th class="head">Answer</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Is the thief taller than 150 cm?</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Does the thief have blond hair?</td>
<td>no</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Is the thief bald?</td>
<td>no</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Is the thief younger than 30?</td>
<td>no</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Does the thief live east of the castle?</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Does the thief have black or brown hair?</td>
<td>yes</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>Is the thief taller than 180cm and shorter than 190cm?</td>
<td>no</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td>Is the thief the tallest person in the village?</td>
<td>no</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="9">
<li></li>
</ol>
</td>
<td>Is the thief shorter than the average villager?</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="10">
<li></li>
</ol>
</td>
<td>Is the thief the oldest person in the eastern part of the village?</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>There is too much information to search through by hand, so you decide to use your newly acquired QL skills to help you with your investigation…</p>
<ol class="arabic simple">
<li>Open the <a class="reference external" href="https://lgtm.com/query">query console on LGTM.com</a> to get started.</li>
<li>Select a language and a demo project. For this tutorial, any language and project will do.</li>
<li>Delete the default code <code class="docutils literal"><span class="pre">import</span> <span class="pre">&lt;language&gt;</span> <span class="pre">select</span> <span class="pre">&quot;hello</span> <span class="pre">world&quot;</span></code>.</li>
</ol>
</div>
<div class="section" id="ql-libraries">
<h2>QL libraries<a class="headerlink" href="#ql-libraries" title="Permalink to this headline">¶</a></h2>
<p>We’ve defined a number of QL <a class="reference external" href="https://help.semmle.com/QL/ql-handbook/predicates.html">predicates</a> to help you extract data from your table. A QL predicate is a mini-query that expresses a relation between various pieces of data and describes some of their properties. In this case, the predicates give you information about a person, for example their height or age.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Predicate</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">getAge()</span></code></td>
<td>returns the age of the person (in years) as an <code class="docutils literal"><span class="pre">int</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">getHairColor()</span></code></td>
<td>returns the hair color of the person as a <code class="docutils literal"><span class="pre">string</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">getHeight()</span></code></td>
<td>returns the height of the person (in cm) as a <code class="docutils literal"><span class="pre">float</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">getLocation()</span></code></td>
<td>returns the location of the person’s home (north, south, east or west) as a <code class="docutils literal"><span class="pre">string</span></code></td>
</tr>
</tbody>
</table>
<p>We’ve stored these predicates in the QL library <code class="docutils literal"><span class="pre">tutorial.qll</span></code>. To access this library, type <code class="docutils literal"><span class="pre">import</span> <span class="pre">tutorial</span></code> in the query console.</p>
<p>Libraries are convenient for storing commonly used predicates. This saves you from defining a predicate every time you need it. Instead you can just <code class="docutils literal"><span class="pre">import</span></code> the library and use the predicate directly. Once you have imported the library, you can apply any of these predicates to an expression by appending it.</p>
<p>For example, <code class="docutils literal"><span class="pre">t.getHeight()</span></code> applies <code class="docutils literal"><span class="pre">getHeight()</span></code> to <code class="docutils literal"><span class="pre">t</span></code> and returns the height of <code class="docutils literal"><span class="pre">t</span></code>.</p>
</div>
<div class="section" id="start-the-search">
<h2>Start the search<a class="headerlink" href="#start-the-search" title="Permalink to this headline">¶</a></h2>
<p>The villagers answered “yes” to the question “Is the thief taller than 150cm?” To use this information, you can write the following query to list all villagers taller than 150cm. These are all possible suspects.</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="n">Person</span> <span class="n">t</span>
<span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">getHeight</span><span class="p">()</span> <span class="o">&gt;</span> <span class="m">150</span>
<span class="k">select</span> <span class="n">t</span>
</pre></div>
</div>
<p>The first line, <code class="docutils literal"><span class="pre">from</span> <span class="pre">Person</span> <span class="pre">t</span></code>, declares that <code class="docutils literal"><span class="pre">t</span></code> must be a <code class="docutils literal"><span class="pre">Person</span></code>. We say that the <a class="reference external" href="https://help.semmle.com/QL/ql-handbook/types.html">type</a> of <code class="docutils literal"><span class="pre">t</span></code> is <code class="docutils literal"><span class="pre">Person</span></code>.</p>
<p>Before you use the rest of your answers in your QL search, here are some more tools and examples to help you write your own QL queries:</p>
</div>
<div class="section" id="logical-connectives">
<h2>Logical connectives<a class="headerlink" href="#logical-connectives" title="Permalink to this headline">¶</a></h2>
<p>Using <a class="reference external" href="https://help.semmle.com/QL/ql-handbook/formulas.html#logical-connectives">logical connectives</a>, you can write more complex queries that combine different pieces of information.</p>
<p>For example, if you know that the thief is older than 30 <em>and</em> has brown hair, you can use the following <code class="docutils literal"><span class="pre">where</span></code> clause to link two predicates:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">&gt;</span> <span class="m">30</span> <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="n">getHairColor</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;brown&quot;</span>
</pre></div>
</div>
<blockquote class="pull-quote">
<div><p>Note</p>
<p>The predicate <code class="docutils literal"><span class="pre">getHairColor()</span></code> returns a <code class="docutils literal"><span class="pre">string</span></code>, so we need to include quotation marks around the result <code class="docutils literal"><span class="pre">&quot;brown&quot;</span></code>.</p>
</div></blockquote>
<p>If the thief does <em>not</em> live north of the castle, you can use:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">where</span> <span class="k">not</span> <span class="n">t</span><span class="p">.</span><span class="n">getLocation</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;north&quot;</span>
</pre></div>
</div>
<p>If the thief has brown hair <em>or</em> black hair, you can use:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">getHairColor</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;brown&quot;</span> <span class="k">or</span> <span class="n">t</span><span class="p">.</span><span class="n">getHairColor</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span>
</pre></div>
</div>
<p>You can also combine these connectives into longer statements:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">&gt;</span> <span class="m">30</span>
  <span class="k">and</span> <span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">getHairColor</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;brown&quot;</span> <span class="k">or</span> <span class="n">t</span><span class="p">.</span><span class="n">getHairColor</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">)</span>
  <span class="k">and</span> <span class="k">not</span> <span class="n">t</span><span class="p">.</span><span class="n">getLocation</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;north&quot;</span>
</pre></div>
</div>
<blockquote class="pull-quote">
<div><p>Note</p>
<p>We’ve placed parentheses around the <code class="docutils literal"><span class="pre">or</span></code> clause to make sure that the query is evaluated as intended. Without parentheses, the connective <code class="docutils literal"><span class="pre">and</span></code> takes precedence over <code class="docutils literal"><span class="pre">or</span></code>.</p>
</div></blockquote>
<p>Predicates don’t always return exactly one value. For example, if a person <code class="docutils literal"><span class="pre">p</span></code> has black hair which is turning gray, <code class="docutils literal"><span class="pre">p.getHairColor()</span></code> will return two values: black and gray.</p>
<p>What if the thief is bald? In that case, the thief has no hair, so the <code class="docutils literal"><span class="pre">getHairColor()</span></code> predicate simply doesn’t return any results!</p>
<p>If you know that the thief definitely isn’t bald, then there must be a color that matches the thief’s hair color. One way to express this in QL is to introduce a new variable <code class="docutils literal"><span class="pre">c</span></code> of type <code class="docutils literal"><span class="pre">string</span></code> and select those <code class="docutils literal"><span class="pre">t</span></code> where <code class="docutils literal"><span class="pre">t.getHairColor()</span></code> matches a value of <code class="docutils literal"><span class="pre">c</span></code>.</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="n">Person</span> <span class="n">t</span><span class="p">,</span> <span class="kt">string</span> <span class="n">c</span>
<span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">getHairColor</span><span class="p">()</span> <span class="o">=</span> <span class="n">c</span>
<span class="k">select</span> <span class="n">t</span>
</pre></div>
</div>
<p>Notice that we have only temporarily introduced the variable <code class="docutils literal"><span class="pre">c</span></code> and we didn’t need it at all in the <code class="docutils literal"><span class="pre">select</span></code> clause. In this case, it is better to use <code class="docutils literal"><span class="pre">exists</span></code>:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="n">Person</span> <span class="n">t</span>
<span class="k">where</span> <span class="k">exists</span><span class="p">(</span><span class="kt">string</span> <span class="n">c</span> <span class="o">|</span> <span class="n">t</span><span class="p">.</span><span class="n">getHairColor</span><span class="p">()</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span>
<span class="k">select</span> <span class="n">t</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">exists</span></code> introduces a temporary variable <code class="docutils literal"><span class="pre">c</span></code> of type <code class="docutils literal"><span class="pre">string</span></code> and holds only if there is at least one <code class="docutils literal"><span class="pre">string</span> <span class="pre">c</span></code> that satisfies <code class="docutils literal"><span class="pre">t.getHairColor()</span> <span class="pre">=</span> <span class="pre">c</span></code>.</p>
<blockquote class="pull-quote">
<div><p>Note</p>
<p>If you are familiar with logic, you may notice that <code class="docutils literal"><span class="pre">exists</span></code> in QL corresponds to the existential <a class="reference external" href="https://help.semmle.com/QL/ql-handbook/formulas.html#quantified-formulas">quantifier</a> in logic. QL also has a universal quantifier <code class="docutils literal"><span class="pre">forall(vars</span> <span class="pre">|</span> <span class="pre">formula</span> <span class="pre">1</span> <span class="pre">|</span> <span class="pre">formula</span> <span class="pre">2)</span></code> which is logically equivalent to <code class="docutils literal"><span class="pre">not</span> <span class="pre">exists(vars</span> <span class="pre">|</span> <span class="pre">formula</span> <span class="pre">1</span> <span class="pre">|</span> <span class="pre">not</span> <span class="pre">formula</span> <span class="pre">2)</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="the-real-investigation">
<h2>The real investigation<a class="headerlink" href="#the-real-investigation" title="Permalink to this headline">¶</a></h2>
<p>You are now ready to track down the thief! Using the examples above, write a query to find the people who satisfy the answers to the first eight questions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="84%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">Question</th>
<th class="head">Answer</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Is the thief taller than 150 cm?</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Does the thief have blond hair?</td>
<td>no</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Is the thief bald?</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Is the thief younger than 30?</td>
<td>no</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Does the thief live east of the castle?</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>Does the thief have black or brown hair?</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>7</td>
<td>Is the thief taller than 180cm and shorter than 190cm?</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>Is the thief the oldest person in the village?</td>
<td>no</td>
</tr>
</tbody>
</table>
<div class="section" id="hints">
<h3>Hints<a class="headerlink" href="#hints" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Don’t forget to <code class="docutils literal"><span class="pre">import</span> <span class="pre">tutorial</span></code>!</li>
<li>Translate each question into QL separately. Look at the examples above if you get stuck.</li>
<li>For question 3, remember that a bald person does not have a hair color.</li>
<li>For question 8, note that if a person is <em>not</em> the oldest, then there is at least one person who is older than them.</li>
<li>Combine the conditions using logical connectives to get a query of the form:</li>
</ol>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">tutorial</span>

<span class="k">from</span> <span class="n">Person</span> <span class="n">t</span>
<span class="k">where</span> <span class="o">&lt;</span><span class="n">condition</span> <span class="m">1</span><span class="o">&gt;</span> <span class="k">and</span>
  <span class="k">not</span> <span class="o">&lt;</span><span class="n">condition</span> <span class="m">2</span><span class="o">&gt;</span> <span class="k">and</span>
  <span class="p">...</span>
<span class="k">select</span> <span class="n">t</span>
</pre></div>
</div>
<p>Once you have finished, you will have a list of possible suspects. One of those people must be the thief!</p>
<p>➤ <a class="reference external" href="https://lgtm.com/query/1505743955992/">See the answer in the query console on LGTM.com</a></p>
<blockquote class="pull-quote">
<div><p>Note</p>
<p>In the answer, we used <code class="docutils literal"><span class="pre">/*</span></code> and <code class="docutils literal"><span class="pre">*/</span></code> to label the different parts of the query. Any text surrounded by <code class="docutils literal"><span class="pre">/*</span></code> and <code class="docutils literal"><span class="pre">*/</span></code> is not evaluated as part of the QL code, but is just a <em>comment</em>.</p>
</div></blockquote>
<p>You are getting closer to solving the mystery! Unfortunately, you still have quite a long list of suspects… To find out which of your suspects is the thief, you must gather more information and refine your query in the next step.</p>
</div>
</div>
<div class="section" id="more-advanced-queries">
<h2>More advanced queries<a class="headerlink" href="#more-advanced-queries" title="Permalink to this headline">¶</a></h2>
<p>What if you want to find the oldest, youngest, tallest, or shortest person in the village? As mentioned in the previous topic, you can do this using <code class="docutils literal"><span class="pre">exists</span></code>. However, there is also a more efficient way to do this in QL using functions like <code class="docutils literal"><span class="pre">max</span></code> and <code class="docutils literal"><span class="pre">min</span></code>. These are examples of <a class="reference external" href="https://help.semmle.com/QL/ql-handbook/expressions.html#aggregations">aggregates</a>.</p>
<p>In general, an aggregate is a function that performs an operation on multiple pieces of data and returns a single value as its output. Common aggregates are <code class="docutils literal"><span class="pre">count</span></code>, <code class="docutils literal"><span class="pre">max</span></code>, <code class="docutils literal"><span class="pre">min</span></code>, <code class="docutils literal"><span class="pre">avg</span></code> (average) and <code class="docutils literal"><span class="pre">sum</span></code>. The general way to use an aggregate is:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">aggregate</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">variable</span> <span class="n">declarations</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">logical</span> <span class="n">formula</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, you can use the <code class="docutils literal"><span class="pre">max</span></code> aggregate to find the age of the oldest person in the village:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">max</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">|</span> <span class="k">exists</span><span class="p">(</span><span class="n">Person</span> <span class="n">p</span> <span class="o">|</span> <span class="n">p</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span> <span class="o">|</span> <span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>This aggregate considers all integers <code class="docutils literal"><span class="pre">i</span></code>, limits <code class="docutils literal"><span class="pre">i</span></code> to values that match the ages of people in the village, and then returns the largest matching integer.</p>
<p>But how can you use this in an actual query?</p>
<p>If the thief is the oldest person in the village, then you know that the thief’s age is equal to the maximum age of the villagers:</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="n">Person</span> <span class="n">t</span>
<span class="k">where</span> <span class="n">t</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">=</span> <span class="k">max</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">|</span> <span class="k">exists</span><span class="p">(</span><span class="n">Person</span> <span class="n">p</span> <span class="o">|</span> <span class="n">p</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span> <span class="o">|</span> <span class="n">i</span><span class="p">)</span>
<span class="k">select</span> <span class="n">t</span>
</pre></div>
</div>
<p>This general aggregate syntax is quite long and inconvenient. In most cases, you can omit certain parts of the aggregate. A particularly helpful QL feature is <em>ordered aggregation</em>. This allows you to order the expression using <code class="docutils literal"><span class="pre">order</span> <span class="pre">by</span></code>.</p>
<p>For example, selecting the oldest villager becomes much simpler if you use an ordered aggregate.</p>
<div class="highlight-ql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">Person</span> <span class="n">p</span> <span class="o">|</span> <span class="o">|</span> <span class="n">p</span> <span class="k">order</span> <span class="k">by</span> <span class="n">p</span><span class="p">.</span><span class="n">getAge</span><span class="p">())</span>
</pre></div>
</div>
<p>The ordered aggregate considers every person <code class="docutils literal"><span class="pre">p</span></code> and selects the person with the maximum age. In this case, there are no restrictions on what people to consider, so the <code class="docutils literal"><span class="pre">&lt;logical</span> <span class="pre">formula&gt;</span></code> clause is empty. Note that if there are several people with the same maximum age, the query lists all of them.</p>
<p>Here are some more examples of aggregates:</p>
<table border="1" class="docutils">
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Example</th>
<th class="head">Result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">min(Person</span> <span class="pre">p</span> <span class="pre">|</span> <span class="pre">p.getLocation()</span> <span class="pre">=</span> <span class="pre">&quot;east&quot;</span> <span class="pre">|</span> <span class="pre">p</span> <span class="pre">order</span> <span class="pre">by</span> <span class="pre">p.getHeight())</span></code></td>
<td>shortest person in the east of the village</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">count(Person</span> <span class="pre">p</span> <span class="pre">|</span> <span class="pre">p.getLocation()</span> <span class="pre">=</span> <span class="pre">&quot;south&quot;</span> <span class="pre">|</span> <span class="pre">p)</span></code></td>
<td>number of people in the south of the village</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">avg(Person</span> <span class="pre">p</span> <span class="pre">|</span> <span class="pre">|</span> <span class="pre">p.getHeight())</span></code></td>
<td>average height of the villagers</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">sum(Person</span> <span class="pre">p</span> <span class="pre">|</span> <span class="pre">p.getHairColor()</span> <span class="pre">=</span> <span class="pre">&quot;brown&quot;</span> <span class="pre">|</span> <span class="pre">p.getAge())</span></code></td>
<td>combined age of all the villagers with brown hair</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="capture-the-culprit">
<h2>Capture the culprit<a class="headerlink" href="#capture-the-culprit" title="Permalink to this headline">¶</a></h2>
<p>You can now translate the remaining questions into QL:</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="84%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">Question</th>
<th class="head">Answer</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="row-odd"><td>9</td>
<td>Is the thief the tallest person in the village?</td>
<td>no</td>
</tr>
<tr class="row-even"><td>10</td>
<td>Is the thief shorter than the average villager?</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>Is the thief the oldest person in the eastern part of the village?</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>Have you found the thief?</p>
<p>➤ <a class="reference external" href="https://lgtm.com/query/1505744186085/">See the answer in the query console on LGTM.com</a></p>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>“<a class="reference external" href="https://help.semmle.com/QL/ql-handbook">QL language reference</a>”</li>
<li>“<a class="reference external" href="https://help.semmle.com/codeql/codeql-tools.html">CodeQL tools</a>”</li>
</ul>
</div>
</div>


    </article>

    <!-- GitHub footer, with links to terms and privacy statement -->
    <div class="px-3 px-md-6 f6 py-4 d-sm-flex flex-justify-between flex-row-reverse flex-items-center border-top">
        <ul class="list-style-none d-flex flex-items-center mb-3 mb-sm-0 lh-condensed-ultra">
            <li class="mr-3">
                <a href="https://twitter.com/github" title="GitHub on Twitter" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 273.5 222.3" class="d-block" height="18">
                        <path
                            d="M273.5 26.3a109.77 109.77 0 0 1-32.2 8.8 56.07 56.07 0 0 0 24.7-31 113.39 113.39 0 0 1-35.7 13.6 56.1 56.1 0 0 0-97 38.4 54 54 0 0 0 1.5 12.8A159.68 159.68 0 0 1 19.1 10.3a56.12 56.12 0 0 0 17.4 74.9 56.06 56.06 0 0 1-25.4-7v.7a56.11 56.11 0 0 0 45 55 55.65 55.65 0 0 1-14.8 2 62.39 62.39 0 0 1-10.6-1 56.24 56.24 0 0 0 52.4 39 112.87 112.87 0 0 1-69.7 24 119 119 0 0 1-13.4-.8 158.83 158.83 0 0 0 86 25.2c103.2 0 159.6-85.5 159.6-159.6 0-2.4-.1-4.9-.2-7.3a114.25 114.25 0 0 0 28.1-29.1"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.facebook.com/GitHub" title="GitHub on Facebook" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.3 15.4" class="d-block" height="18">
                        <path
                            d="M14.5 0H.8a.88.88 0 0 0-.8.9v13.6a.88.88 0 0 0 .8.9h7.3v-6h-2V7.1h2V5.4a2.87 2.87 0 0 1 2.5-3.1h.5a10.87 10.87 0 0 1 1.8.1v2.1h-1.3c-1 0-1.1.5-1.1 1.1v1.5h2.3l-.3 2.3h-2v5.9h3.9a.88.88 0 0 0 .9-.8V.8a.86.86 0 0 0-.8-.8z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.youtube.com/github" title="GitHub on YouTube" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.17 13.6" class="d-block" height="16">
                        <path
                            d="M18.77 2.13A2.4 2.4 0 0 0 17.09.42C15.59 0 9.58 0 9.58 0a57.55 57.55 0 0 0-7.5.4A2.49 2.49 0 0 0 .39 2.13 26.27 26.27 0 0 0 0 6.8a26.15 26.15 0 0 0 .39 4.67 2.43 2.43 0 0 0 1.69 1.71c1.52.42 7.5.42 7.5.42a57.69 57.69 0 0 0 7.51-.4 2.4 2.4 0 0 0 1.68-1.71 25.63 25.63 0 0 0 .4-4.67 24 24 0 0 0-.4-4.69zM7.67 9.71V3.89l5 2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3 flex-self-start">
                <a href="https://www.linkedin.com/company/github" title="GitHub on Linkedin" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 18" class="d-block" height="18">
                        <path
                            d="M3.94 2A2 2 0 1 1 2 0a2 2 0 0 1 1.94 2zM4 5.48H0V18h4zm6.32 0H6.34V18h3.94v-6.57c0-3.66 4.77-4 4.77 0V18H19v-7.93c0-6.17-7.06-5.94-8.72-2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://github.com/github" title="GitHub's organization" style="color: #959da5;">
                    <svg version="1.1" width="20" height="20" viewBox="0 0 16 16" class="octicon octicon-mark-github"
                        aria-hidden="true">
                        <path fill-rule="evenodd"
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                        </path>
                    </svg>
                </a>
            </li>
        </ul>
        <ul class="list-style-none d-flex text-gray">
            <li class="mr-3">&copy; 2020 GitHub, Inc.</li>
            <li class="mr-3"><a
                    href="https://docs.github.com/github/site-policy/github-terms-of-service"
                    class="link-gray">Terms </a></li>
            <li><a href="https://docs.github.com/github/site-policy/github-privacy-statement"
                    class="link-gray">Privacy </a></li>
        </ul>
    </div>
</div>
</main>

<script type="text/javascript">
    $(document).ready(function () {
        $(".toggle > *").hide();
        $(".toggle .name").show();
        $(".toggle .name").click(function () {
            $(this).parent().children().not(".name").toggle(400);
            $(this).parent().children(".name").toggleClass("open");
        })
    });
</script>

  </body>
</html>